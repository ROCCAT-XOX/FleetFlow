{{ template "head" .}}
<body class="bg-gray-50">
{{ template "navigation" .}}

<!-- Hauptinhalt -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="md:flex md:items-center md:justify-between mb-6">
        <div class="flex-1 min-w-0">
            <h1 class="text-2xl font-bold text-gray-900">Einstellungen</h1>
            <p class="mt-1 text-sm text-gray-500">Verwalten Sie die Systemeinstellungen und Konfigurationen</p>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="mb-6 border-b border-gray-200">
        <nav class="flex space-x-8" aria-label="Tabs">
            <button class="tab-btn border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="general">
                Allgemein
            </button>
            <button class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="notifications">
                Benachrichtigungen
            </button>
            <button class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="appearance">
                Erscheinungsbild
            </button>
            {{ if eq .userRole "admin" }}
            <button class="tab-btn border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="users">
                Benutzerverwaltung
            </button>
            {{ end }}
        </nav>
    </div>

    <!-- Tab-Inhalte -->
    <div id="settings-tabs-content">
        <!-- Allgemeine Einstellungen -->
        <div id="general" class="settings-tab-content">
            <div class="bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Allgemeine Einstellungen</h3>
                    <div class="mt-2 max-w-xl text-sm text-gray-500">
                        <p>Passen Sie grundlegende Einstellungen des Systems an.</p>
                    </div>
                    <form class="mt-5 space-y-6">
                        <div>
                            <label for="company-name" class="block text-sm font-medium text-gray-700">Unternehmensname</label>
                            <input type="text" name="company-name" id="company-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="FleetFlow GmbH">
                        </div>
                        <div>
                            <label for="company-address" class="block text-sm font-medium text-gray-700">Adresse</label>
                            <textarea id="company-address" name="company-address" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">Musterstraße 123
80333 München</textarea>
                        </div>
                        <div>
                            <label for="timezone" class="block text-sm font-medium text-gray-700">Zeitzone</label>
                            <select id="timezone" name="timezone" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="Europe/Berlin" selected>Europa/Berlin (CET/CEST)</option>
                                <option value="Europe/London">Europa/London (GMT/BST)</option>
                                <option value="America/New_York">Amerika/New York (EST/EDT)</option>
                            </select>
                        </div>
                        <div>
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Speichern
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Benachrichtigungseinstellungen -->
        <div id="notifications" class="settings-tab-content hidden">
            <div class="bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Benachrichtigungseinstellungen</h3>
                    <div class="mt-2 max-w-xl text-sm text-gray-500">
                        <p>Legen Sie fest, welche Benachrichtigungen Sie erhalten möchten.</p>
                    </div>
                    <form class="mt-5 space-y-6">
                        <fieldset>
                            <legend class="text-sm font-medium text-gray-700">E-Mail-Benachrichtigungen</legend>
                            <div class="mt-4 space-y-4">
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="email-bookings" name="email-bookings" type="checkbox" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="email-bookings" class="font-medium text-gray-700">Buchungsbenachrichtigungen</label>
                                        <p class="text-gray-500">Erhalten Sie eine Benachrichtigung bei neuen Fahrzeugbuchungen.</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="email-maintenance" name="email-maintenance" type="checkbox" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="email-maintenance" class="font-medium text-gray-700">Wartungsbenachrichtigungen</label>
                                        <p class="text-gray-500">Erhalten Sie eine Benachrichtigung bei anstehenden Wartungen.</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="email-reports" name="email-reports" type="checkbox" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="email-reports" class="font-medium text-gray-700">Berichtsbenachrichtigungen</label>
                                        <p class="text-gray-500">Erhalten Sie wöchentliche und monatliche Berichte per E-Mail.</p>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend class="text-sm font-medium text-gray-700">System-Benachrichtigungen</legend>
                            <div class="mt-4 space-y-4">
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="system-alerts" name="system-alerts" type="checkbox" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="system-alerts" class="font-medium text-gray-700">Systemwarnungen</label>
                                        <p class="text-gray-500">Erhalten Sie Benachrichtigungen über wichtige Systemereignisse.</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="flex items-center h-5">
                                        <input id="driver-alerts" name="driver-alerts" type="checkbox" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="driver-alerts" class="font-medium text-gray-700">Fahrerbenachrichtigungen</label>
                                        <p class="text-gray-500">Erhalten Sie Benachrichtigungen über Führerscheinablauf und Schulungen.</p>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <div>
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Speichern
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Erscheinungsbild-Einstellungen -->
        <div id="appearance" class="settings-tab-content hidden">
            <div class="bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:p-6">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Erscheinungsbild</h3>
                    <div class="mt-2 max-w-xl text-sm text-gray-500">
                        <p>Passen Sie das Erscheinungsbild der Benutzeroberfläche an.</p>
                    </div>
                    <form class="mt-5 space-y-6">
                        <fieldset>
                            <legend class="text-sm font-medium text-gray-700">Farbschema</legend>
                            <div class="mt-4 space-y-4">
                                <div class="flex items-center">
                                    <input id="theme-light" name="theme" type="radio" checked class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                    <label for="theme-light" class="ml-3 block text-sm font-medium text-gray-700">
                                        Helles Design
                                    </label>
                                </div>
                                <div class="flex items-center">
                                    <input id="theme-dark" name="theme" type="radio" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                    <label for="theme-dark" class="ml-3 block text-sm font-medium text-gray-700">
                                        Dunkles Design
                                    </label>
                                </div>
                                <div class="flex items-center">
                                    <input id="theme-system" name="theme" type="radio" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                    <label for="theme-system" class="ml-3 block text-sm font-medium text-gray-700">
                                        Systemeinstellung
                                    </label>
                                </div>
                            </div>
                        </fieldset>
                        <div>
                            <label for="language" class="block text-sm font-medium text-gray-700">Sprache</label>
                            <select id="language" name="language" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option selected>Deutsch</option>
                                <option>English</option>
                                <option>Français</option>
                                <option>Español</option>
                            </select>
                        </div>
                        <div>
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Speichern
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Benutzerverwaltung -->
        {{ if eq .userRole "admin" }}
        <div id="users" class="settings-tab-content hidden">
            <div class="bg-white shadow sm:rounded-lg mb-6">
                <div class="px-4 py-5 sm:p-6">
                    <div class="sm:flex sm:items-center sm:justify-between">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Benutzerverwaltung</h3>
                            <p class="mt-1 text-sm text-gray-500">Fügen Sie Benutzer hinzu oder bearbeiten Sie bestehende Benutzerkonten.</p>
                        </div>
                        <button type="button" id="add-user-btn" class="mt-3 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            Benutzer hinzufügen
                        </button>
                    </div>
                </div>

                <!-- Benutzerliste -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">E-Mail</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rolle</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Aktionen</th>
                        </tr>
                        </thead>
                        <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Platzhalter für dynamische Daten -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {{ end }}
    </div>
</div>

<!-- Benutzer-Modals -->
<!-- Modal: Benutzer hinzufügen -->
<div id="addUserModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Hintergrund-Overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

        <!-- Zentriert den Modal-Inhalt -->
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

        <!-- Modal-Panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <form id="addUserForm">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">
                                Benutzer hinzufügen
                            </h3>

                            <div class="mt-4">
                                <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                                    <div class="sm:col-span-3">
                                        <label for="firstName" class="block text-sm font-medium text-gray-700">Vorname</label>
                                        <input type="text" name="firstName" id="firstName" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-3">
                                        <label for="lastName" class="block text-sm font-medium text-gray-700">Nachname</label>
                                        <input type="text" name="lastName" id="lastName" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="email" class="block text-sm font-medium text-gray-700">E-Mail</label>
                                        <input type="email" name="email" id="email" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="password" class="block text-sm font-medium text-gray-700">Passwort</label>
                                        <input type="password" name="password" id="password" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-3">
                                        <label for="role" class="block text-sm font-medium text-gray-700">Rolle</label>
                                        <select id="role" name="role" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="user">Benutzer</option>
                                            <option value="manager">Manager</option>
                                            <option value="admin">Administrator</option>
                                        </select>
                                    </div>

                                    <div class="sm:col-span-3">
                                        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                                        <select id="status" name="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="active">Aktiv</option>
                                            <option value="inactive">Inaktiv</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Hinzufügen
                    </button>
                    <button type="button" onclick="closeModal('addUserModal')" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Benutzer bearbeiten -->
<div id="editUserModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <!-- Hintergrund-Overlay -->
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

        <!-- Zentriert den Modal-Inhalt -->
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

        <!-- Modal-Panel -->
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <form id="editUserForm">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">
                                Benutzer bearbeiten
                            </h3>

                            <div class="mt-4">
                                <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                                    <div class="sm:col-span-3">
                                        <label for="edit-firstName" class="block text-sm font-medium text-gray-700">Vorname</label>
                                        <input type="text" name="firstName" id="edit-firstName" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-3">
                                        <label for="edit-lastName" class="block text-sm font-medium text-gray-700">Nachname</label>
                                        <input type="text" name="lastName" id="edit-lastName" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="edit-email" class="block text-sm font-medium text-gray-700">E-Mail</label>
                                        <input type="email" name="email" id="edit-email" required class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-6">
                                        <label for="edit-password" class="block text-sm font-medium text-gray-700">Neues Passwort (leer lassen, wenn unverändert)</label>
                                        <input type="password" name="password" id="edit-password" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>

                                    <div class="sm:col-span-3">
                                        <label for="edit-role" class="block text-sm font-medium text-gray-700">Rolle</label>
                                        <select id="edit-role" name="role" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="user">Benutzer</option>
                                            <option value="manager">Manager</option>
                                            <option value="admin">Administrator</option>
                                        </select>
                                    </div>

                                    <div class="sm:col-span-3">
                                        <label for="edit-status" class="block text-sm font-medium text-gray-700">Status</label>
                                        <select id="edit-status" name="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="active">Aktiv</option>
                                            <option value="inactive">Inaktiv</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Speichern
                    </button>
                    <button type="button" onclick="closeModal('editUserModal')" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Tab-Funktionalität
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.settings-tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');

                // Alle Tabs deaktivieren
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-indigo-500', 'text-indigo-600');
                    btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });

                // Alle Tab-Inhalte verstecken
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });

                // Aktuellen Tab aktivieren
                this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                this.classList.add('border-indigo-500', 'text-indigo-600');

                // Aktuellen Tab-Inhalt anzeigen
                document.getElementById(tabId).classList.remove('hidden');

                // Wenn Benutzer-Tab aktiviert wird, lade die Benutzer
                if (tabId === 'users') {
                    loadUsers();
                }
            });
        });

        // Add User Button Event Listener
        const addUserBtn = document.getElementById('add-user-btn');
        if (addUserBtn) {
            addUserBtn.addEventListener('click', () => openModal('addUserModal'));
        }
    });

    // Benutzer laden
    function loadUsers() {
        fetch('/api/users')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Laden der Benutzer');
                }
                return response.json();
            })
            .then(data => {
                const users = data.users || [];
                renderUsers(users);
            })
            .catch(error => {
                console.error('Fehler:', error);
                const tableBody = document.getElementById('users-table-body');
                if (tableBody) {
                    tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-sm text-red-500">
                            Fehler beim Laden der Benutzer: ${error.message}
                        </td>
                    </tr>
                `;
                }
            });
    }

    // Benutzer in Tabelle rendern
    function renderUsers(users) {
        const tableBody = document.getElementById('users-table-body');
        if (!tableBody) return;

        if (users.length === 0) {
            tableBody.innerHTML = `
            <tr>
                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                    Keine Benutzer gefunden
                </td>
            </tr>
        `;
            return;
        }

        tableBody.innerHTML = users.map(user => {
            const roleClass = getRoleClass(user.role);
            const statusClass = getStatusClass(user.status);

            return `
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <span class="text-indigo-600 font-medium text-sm">
                                ${(user.firstName || user.username || 'U')[0].toUpperCase()}
                            </span>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">
                                ${user.firstName || ''} ${user.lastName || ''}
                            </div>
                            <div class="text-sm text-gray-500">
                                ${user.username || ''}
                            </div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${user.email || ''}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${roleClass}">
                        ${getRoleText(user.role)}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                        ${getStatusText(user.status)}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button onclick="openEditUserModal('${user.id}', '${user.firstName || ''}', '${user.lastName || ''}', '${user.email || ''}', '${user.role}', '${user.status}')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                        Bearbeiten
                    </button>
                    <button onclick="confirmDeleteUser('${user.id}', '${user.firstName || user.username}')" class="text-red-600 hover:text-red-900">
                        Löschen
                    </button>
                </td>
            </tr>
        `;
        }).join('');
    }

    // Hilfsfunktionen für Klassen und Text
    function getRoleClass(role) {
        switch (role) {
            case 'admin':
                return 'bg-purple-100 text-purple-800';
            case 'manager':
                return 'bg-blue-100 text-blue-800';
            default:
                return 'bg-green-100 text-green-800';
        }
    }

    function getStatusClass(status) {
        return status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
    }

    function getRoleText(role) {
        switch (role) {
            case 'admin':
                return 'Administrator';
            case 'manager':
                return 'Manager';
            default:
                return 'Benutzer';
        }
    }

    function getStatusText(status) {
        return status === 'active' ? 'Aktiv' : 'Inaktiv';
    }

    // Modal-Funktionen
    function openModal(modalId) {
        document.getElementById(modalId).classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    // Benutzer bearbeiten
    function openEditUserModal(id, firstName, lastName, email, role, status) {
        // Formular vorausfüllen
        document.getElementById('edit-firstName').value = firstName;
        document.getElementById('edit-lastName').value = lastName;
        document.getElementById('edit-email').value = email;
        document.getElementById('edit-role').value = role;
        document.getElementById('edit-status').value = status;

        // ID speichern (z.B. in einem data-Attribut)
        const form = document.getElementById('editUserForm');
        form.setAttribute('data-user-id', id);

        openModal('editUserModal');
    }

    // Benutzer löschen bestätigen
    function confirmDeleteUser(id, name) {
        if (confirm(`Möchten Sie den Benutzer "${name}" wirklich löschen?`)) {
            deleteUser(id);
        }
    }

    // API-Aufrufe
    function deleteUser(id) {
        fetch(`/api/users/${id}`, {
            method: 'DELETE',
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Löschen des Benutzers');
                }
                return response.json();
            })
            .then(data => {
                alert('Benutzer erfolgreich gelöscht!');
                loadUsers(); // Benutzer neu laden
            })
            .catch(error => {
                console.error('Fehler:', error);
                alert('Fehler beim Löschen des Benutzers');
            });
    }

    // Formular-Handling
    document.getElementById('addUserForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(this);
        const userData = {};

        for (let [key, value] of formData.entries()) {
            userData[key] = value;
        }

        // API-Aufruf zum Hinzufügen des Benutzers
        fetch('/api/users', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(userData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Hinzufügen des Benutzers');
                }
                return response.json();
            })
            .then(data => {
                closeModal('addUserModal');
                alert('Benutzer erfolgreich hinzugefügt!');
                loadUsers(); // Benutzer neu laden
            })
            .catch(error => {
                console.error('Fehler:', error);
                alert('Fehler beim Hinzufügen des Benutzers');
            });
    });

    document.getElementById('editUserForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const userId = this.getAttribute('data-user-id');
        const formData = new FormData(this);
        const userData = {};

        for (let [key, value] of formData.entries()) {
            userData[key] = value;
        }

        // API-Aufruf zum Aktualisieren des Benutzers
        fetch(`/api/users/${userId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(userData)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Fehler beim Aktualisieren des Benutzers');
                }
                return response.json();
            })
            .then(data => {
                closeModal('editUserModal');
                alert('Benutzer erfolgreich aktualisiert!');
                loadUsers(); // Benutzer neu laden
            })
            .catch(error => {
                console.error('Fehler:', error);
                alert('Fehler beim Aktualisieren des Benutzers');
            });
    });
</script>

{{ template "footer" .}}
</body>
</html>